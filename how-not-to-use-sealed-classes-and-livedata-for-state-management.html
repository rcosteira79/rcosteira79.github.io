<!DOCTYPE html>
<html>
  <head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->

    <title>
      How not to use sealed classes and LiveData for state management
    </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/built/screen.edited.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Roboto:300,400&display=swap"
      rel="stylesheet"
    />
    <!--[if IE]>
      <style>
        p,
        ol,
        ul {
          width: 100%;
        }
        blockquote {
          width: 100%;
        }
      </style>
    <![endif]-->

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta
      name="description"
      content="A mobile software engineer with a passion for Android and clean, maintainable code. I build apps from the ground up and maintain existing ones."
    />
    <link
      rel="shortcut icon"
      href="https://ricardocosteira.com/assets/images/favicon.png"
      type="image/png"
    />
    <link
      rel="canonical"
      href="https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management"
    />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Ricardo Costeira" />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="How not to use sealed classes and LiveData for state management"
    />
    <meta
      property="og:description"
      content="A few months ago, I was washing my dishes while listening to episode 148 of the Fragmented podcast. In this episode, Donn Felker and Kaushik Gopal talk about architecture. To be specific, about an MVI-like architecture that Kaushik has been using. This architecture specifies that each screen has one and"
    />
    <meta
      property="og:url"
      content="https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management"
    />
    <meta
      property="og:image"
      content="https://ricardocosteira.com/assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management.jpg"
    />
    <meta
      property="article:publisher"
      content="https://www.twitter.com/rcosteira79"
    />
    <meta
      property="article:author"
      content="https://www.twitter.com/rcosteira79"
    />
    <meta
      property="article:published_time"
      content="2019-05-28T11:00:00+01:00"
    />
    <meta
      property="article:modified_time"
      content="2019-05-28T11:00:00+01:00"
    />
    <meta property="article:tag" content="Android" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="How not to use sealed classes and LiveData for state management"
    />
    <meta
      name="twitter:description"
      content="A few months ago, I was washing my dishes while listening to episode 148 of the Fragmented podcast. In this episode, Donn Felker and Kaushik Gopal talk about architecture. To be specific, about an MVI-like architecture that Kaushik has been using. This architecture specifies that each screen has one and"
    />
    <meta name="twitter:url" content="https://ricardocosteira.com/" />
    <meta
      name="twitter:image"
      content="https://ricardocosteira.com/assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management.jpg"
    />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ricardo Costeira" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Android" />
    <meta name="twitter:site" content="@rcosteira79" />
    <meta name="twitter:creator" content="@rcosteira79" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Website",
        "publisher": {
          "@type": "Organization",
          "name": "Ricardo Costeira",
          "logo": "https://ricardocosteira.com/"
        },
        "url": "https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management",
        "image": {
          "@type": "ImageObject",
          "url": "https://ricardocosteira.com/assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management.jpg",
          "width": 2000,
          "height": 666
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management"
        },
        "description": "A few months ago, I was washing my dishes while listening to episode 148 of the Fragmented podcast. In this episode, Donn Felker and Kaushik Gopal talk about architecture. To be specific, about an MVI-like architecture that Kaushik has been using. This architecture specifies that each screen has one and"
      }
    </script>

    <meta name="generator" content="Jekyll 3.6.2" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="How not to use sealed classes and LiveData for state management"
      href="/feed.xml"
    />

    <link rel="stylesheet" type="text/css" href="/assets/built/prism.css" />
  </head>
  <body class="post-template">
    <div class="site-wrapper">
      <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
      <!-- default -->

      <!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

      <header class="site-header outer">
        <div class="inner">
          <nav class="site-nav">
            <div class="site-nav-left">
              <ul class="nav" role="menu">
                <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
                <li class="nav-getting-started" role="menuitem">
                  <a href="/tag/android/">Android</a>
                </li>
                <li class="nav-getting-started" role="menuitem">
                  <a href="/tag/talks/">Talks</a>
                </li>
                <li class="nav-about" role="menuitem">
                  <a href="/about/">About</a>
                </li>
              </ul>
            </div>
            <div class="site-nav-right">
              <div class="social-links">
                <a
                  class="social-link social-link-gh"
                  href="https://github.com/rcosteira79"
                  target="_blank"
                  rel="noopener"
                  ><svg
                    role="img"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
                    /></svg
                ></a>

                <a
                  class="social-link social-link-tw"
                  href="https://twitter.com/rcosteira79"
                  target="_blank"
                  rel="noopener"
                  ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                    <path
                      d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"
                    />
                  </svg>
                </a>

                <a
                  class="social-link social-link-lkd"
                  href="https://linkedin.com/in/rcosteira"
                  target="_blank"
                  rel="noopener"
                  ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                    <path
                      d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"
                    /></svg
                ></a>

                <a
                  class="social-link social-link-stackoverflow"
                  href="https://stackoverflow.com/users/2333010/ricardo-costeira"
                  target="_blank"
                  rel="noopener"
                  ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                    <path
                      d="M15 21h-10v-2h10v2zm6-11.665l-1.621-9.335-1.993.346 1.62 9.335 1.994-.346zm-5.964 6.937l-9.746-.975-.186 2.016 9.755.879.177-1.92zm.538-2.587l-9.276-2.608-.526 1.954 9.306 2.5.496-1.846zm1.204-2.413l-8.297-4.864-1.029 1.743 8.298 4.865 1.028-1.744zm1.866-1.467l-5.339-7.829-1.672 1.14 5.339 7.829 1.672-1.14zm-2.644 4.195v8h-12v-8h-2v10h16v-10h-2z"
                    /></svg
                ></a>

                <a
                  class="social-link social-link-medium"
                  href="https://medium.com/@rcosteira79"
                  target="_blank"
                  rel="noopener"
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    viewBox="0 0 32 32"
                  >
                    <path
                      d="M2.846 6.887c.03-.295-.083-.586-.303-.784l-2.24-2.7v-.403h6.958l5.378 11.795 4.728-11.795h6.633v.403l-1.916 1.837c-.165.126-.247.333-.213.538v13.498c-.034.204.048.411.213.537l1.871 1.837v.403h-9.412v-.403l1.939-1.882c.19-.19.19-.246.19-.537v-10.91l-5.389 13.688h-.728l-6.275-13.688v9.174c-.052.385.076.774.347 1.052l2.521 3.058v.404h-7.148v-.404l2.521-3.058c.27-.279.39-.67.325-1.052v-10.608z"
                    /></svg
                ></a>

                <a
                  class="social-link social-link-devto"
                  href="https://dev.to/rcosteira79"
                  target="_blank"
                  rel="noopener"
                  ><svg
                    role="img"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 448 512"
                  >
                    <path
                      fill="#ffffff"
                      d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"
                    ></path></svg
                ></a>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <!-- Everything inside the #post tags pulls data from the post -->
      <!-- #post -->

      <main id="site-main" class="site-main outer" role="main">
        <div class="inner">
          <article class="post-full post tag-android ">
            <header class="post-full-header">
              <section class="post-full-meta">
                <time class="post-full-meta-date" datetime="28 May 2019"
                  >28 May 2019</time
                >

                <span class="date-divider">/</span>

                <a href="/tag/android/">ANDROID</a>
              </section>
              <h1 class="post-full-title">
                How not to use sealed classes and LiveData for state management
              </h1>

              <h2 class="post-full-subtitle">
                A journey about things that don’t work
              </h2>
            </header>

            <div class="post-full-image-caption">
              <figure
                class="post-full-image"
                style="background-image: url(/assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management.jpg)"
              ></figure>

              Photo by
              <a href="https://unsplash.com/@heidi_sandstrom"
                >Heidi Sandstrom.</a
              >

              on <a href="https://unsplash.com">Unsplash</a>.
            </div>

            <section class="post-full-content">
              <div class="kg-card-markdown">
                <p>
                  A few months ago, I was washing my dishes while listening to
                  <a href="https://fragmentedpodcast.com/episodes/148/"
                    >episode 148 of the Fragmented podcast</a
                  >. In this episode, Donn Felker and Kaushik Gopal talk about
                  architecture. To be specific, about an MVI-like architecture
                  that Kaushik has been using.
                </p>

                <p>
                  This architecture specifies that each screen has one and only
                  one ViewModel, that exposes a single observable to the
                  Activity or Fragment. This observable emits the screen’s
                  state: when an update is required, the observable emits a new
                  state object, which the view uses to update its state. To emit
                  a state update, the ViewModel has to receive an event.
                  Different events trigger different updates. Events then
                  generate results, which generate the state updates. Each event
                  class has a corresponding result class.
                </p>

                <p>
                  There are many other nuances around the architecture, but
                  these are the ones that matter for this article.
                </p>

                <h3 id="the-epiphany">The Epiphany</h3>

                <p>
                  In the
                  <a href="https://github.com/kaushikgopal/movies-usf"
                    >sample repo</a
                  >
                  that Kaushik provides, you can see this example of a view
                  state class:
                </p>

                <pre><code class="language-kotlin">data class MSMovieViewState(
    val searchBoxText: String? = null,
    val searchedMovieTitle: String = "",
    val searchedMovieRating: String = "",
    val searchedMoviePoster: String = "",
    val searchedMovieReference: MSMovie? = null,
    val adapterList: List&lt;MSMovie&gt; = emptyList()
)
</code></pre>

                <p>
                  This is quite similar to a
                  <a
                    href="https://martinfowler.com/eaaDev/PresentationModel.html"
                    >presentation model</a
                  >, but without the behavior definition. Also, as you can see,
                  the class is immutable. This means that whenever there’s a new
                  state update, the old values get copied into a new object.
                  This new object also has the updated value for each specific
                  state change. For example, given the events class:
                </p>

                <pre><code class="language-kotlin">sealed class MSMovieEvent {
    object ScreenLoadEvent : MSMovieEvent()
    data class SearchMovieEvent(val searchedMovieTitle: String = "") : MSMovieEvent()
    data class AddToHistoryEvent(val searchedMovie: MSMovie) : MSMovieEvent()
    data class RestoreFromHistoryEvent(val movieFromHistory: MSMovie) : MSMovieEvent()
}
</code></pre>

                <p>
                  for a “add to history event”, you would have something like
                  (this is an oversimplified version of the repo’s code):
                </p>

                <pre><code class="language-kotlin">val movie: MSMovie = result.packet.movie

val newState = oldState.copy(
  searchedMovieTitle = movie.title,
  searchedMovieRating = movie.ratingSummary,
  searchedMoviePoster = movie.posterUrl,
  searchedMovieReference = movie)
</code></pre>

                <p>
                  When I saw this, my train of thought was more or less like
                  “OK, this looks nice. Every state detail becomes enclosed in
                  the same object. But this also means I have to redraw the
                  whole UI on each update, even if I just change a simple text
                  label. This seems rather heavy…”.
                </p>

                <p>
                  I was really hyped about the architecture, but this bummed me
                  out a little. There must be another way…
                </p>

                <p>
                  And then it dawned on me: “What if I tried to use sealed
                  classes for this?”
                </p>

                <h3 id="keep-it-simple-also-keep-it-working-correctly">
                  Keep it simple. Also, keep it working correctly
                </h3>

                <p>
                  Kaushik makes heavy usage of RxJava in this architecture. I
                  love RxJava and think it’s amazing. Yet, like many, I also
                  think that in most cases it’s an overkill. Especially when the
                  framework already provides similar tools for the most common
                  cases. Instead of using RxJava, I’ll be using LiveData for
                  observability. For async work, I’ll use Coroutines. I also
                  won’t be using events or results. Results seem rather
                  redundant when you have observability. As for the events, they
                  also seem to be superfluous: I have methods causing state
                  changes. As such, observability should take care of everything
                  for me, right? Eh, not quite, but we’ll get to that later.
                </p>

                <p>
                  Before I start explaining what I’m about to do, I want to make
                  something clear: I’m not recommending an architecture of any
                  kind. I’m just testing a different approach to an already well
                  defined architecture, and writing about the results. Nothing
                  more. That being said, let’s get started.
                </p>

                <p>
                  I’ll be implementing a Fragment that displays a RecyclerView
                  with a list of user names. Each row has a checkbox that gets
                  checked/unchecked either when you click on it or on the row
                  itself. A button at the bottom of the view will update its
                  label according to the number of selected users. I could’ve
                  picked an even simpler example, but I really wanted to test
                  the limits of this approach.
                </p>

                <p>
                  So, I have two pieces of state here: the contents of the
                  RecyclerView and the button label. I also have the actual user
                  list internal state, i.e., if rows are checked or not.
                  However, since we can consider this as the RecyclerView’s
                  internal state, I’ll let it slide (otherwise, this approach is
                  already failing…).
                </p>

                <p>I came up with the following sealed class:</p>

                <pre><code class="language-kotlin">sealed class RecyclerViewExampleViewState {
  data class UsersListState(val users: List&lt;DisplayedUser&gt;) : RecyclerViewExampleViewState()
  data class ButtonLabelState(val numberOfUsers: String) : RecyclerViewExampleViewState()
  data class PossibleFailureState(val failure: Failure) : RecyclerViewExampleViewState()
}
</code></pre>

                <p>The ViewModel that does all the heavy lifting:</p>

                <pre><code class="language-kotlin">class RecyclerViewExampleViewModel @Inject constructor(
  private val getUsers: GetUsers,
  private val displayedUserMapper: DisplayedUserMapper
) : BaseViewModel() {

  val viewState: LiveData&lt;RecyclerViewExampleViewState&gt;
    get() = _viewState

  private val _viewState: MutableLiveData&lt;RecyclerViewExampleViewState&gt; =
    MutableLiveData()

  init {
    getUsers()
    updateButtonLabel(0)
  }

  fun updateButtonLabel(checkedNumber: Int) {
    val label = if (checkedNumber &gt; 0) " ($checkedNumber)" else ""
    _viewState.value = ButtonLabelState(label)
  }

  private fun getUsers() = getUsers(uiScope, UseCase.None()) {
    it.either(
      ::handleFailure,
      ::handleUserList
    )
  }

  private fun handleFailure(failure: Failure) {
    _viewState.value = PossibleFailureState(failure)
  }

  private fun handleUserList(users: List&lt;User&gt;) {
    val usersToDisplay = users.map { displayedUserMapper.mapToUI(it) }
    _viewState.value = UsersListState(usersToDisplay)
  }
}
</code></pre>

                <p>
                  And the Fragment that updates its view on each state update:
                </p>

                <pre><code class="language-kotlin">class RecyclerViewExampleFragment
: BaseFragment(), RecyclerViewRowClickListener&lt;DisplayedUser&gt; {

  @Inject
  lateinit var viewModel: RecyclerViewExampleViewModel

  lateinit var adapter: UsersAdapter

  override fun onCreateView(
    inflater: LayoutInflater, container: ViewGroup?,
    savedInstanceState: Bundle?
  ): View? {

    return inflater.inflate(R.layout.fragment_recycler_view_example, container, false)
  }

  override fun onActivityCreated(savedInstanceState: Bundle?) {
    super.onActivityCreated(savedInstanceState)

    progressBarLoading.show()
    setRecyclerView()

    viewModel = createViewModel(this) {
      observe(viewLifecycleOwner, viewState, ::renderViewState)
    }
  }

  private fun setRecyclerView() {
    prepareAdapter()
    recyclerViewUsers.layoutManager = LinearLayoutManager(this.context)
    recyclerViewUsers.adapter = adapter
    recyclerViewUsers.setHasFixedSize(true)
  }

  private fun prepareAdapter() {
    adapter = UsersAdapter(this)
  }

  private fun renderViewState(state: RecyclerViewExampleViewState) {

    when (state) {
      is UsersListState -&gt; renderUserList(state.users)
      is ButtonLabelState -&gt; renderButton(state.numberOfUsers)
      is PossibleFailureState -&gt; renderPossibleFailure(state.failure)
    }
  }

  private fun renderUserList(users: List&lt;DisplayedUser&gt;) {
    progressBarLoading.hide()
    adapter.submitList(users)
  }

  private fun renderButton(selectedUsers: String) {
    buttonDoStuff.text =
      getString(R.string.button_label_do_stuff_with_users, selectedUsers)
    buttonDoStuff.isEnabled = !selectedUsers.isBlank()
  }

  private fun renderPossibleFailure(failure: Failure) {
    // TODO computer says no
  }

  override fun onRowClicked(item: DisplayedUser, position: Int) {
    val checkedNumber = adapter.currentList.filter { it.isChecked }.count()
    viewModel.updateButtonLabel(checkedNumber)
  }

  override fun onDestroyView() {
    super.onDestroyView()
    recyclerViewUsers.adapter = null
  }
}
</code></pre>

                <p>
                  Let me walk you through the code. When the ViewModel inits, it
                  immediately tells the repository to fetch the users (GitHub
                  API). It then updates the button label. The Fragment uses the
                  renderViewState method to observe the LiveData. For each
                  different state update, renderViewState will trigger a
                  different method. The Fragment also implements the
                  RecyclerViewRowClickListener interface. This interface allows
                  us to react to clicks on RecyclerView items. The Fragment does
                  this in the onRowClicked method.
                </p>

                <p>This is the result:</p>

                <p>
                  <img
                    src="assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management-1.png"
                    alt=""
                  />
                </p>

                <p>
                  Everything seemingly works as I expected, except for one small
                  (but important) detail. As you may have noticed, the
                  onRowClicked method filters the user list. The filter counts
                  the number of checked rows. Why? Because I can’t use this
                  approach to update state based on a previous state. In other
                  words, because each sealed class is independent. To me, this
                  is the worst disadvantage of using a single LiveData to handle
                  all these state classes: when I create a state update with a
                  certain value, I lose access to it as soon as I set it as the
                  LiveData’s value. Of course, I could always verify the
                  LiveData value on the next state iteration. Unfortunately, I
                  cannot guarantee that the previous update was the one I need.
                  Suddenly, a simple class with the whole state just like
                  Kaushik has seems worth it. Either that or I would need a
                  different LiveData for this specific piece of state. This
                  would also solve the internal RecyclerView state problem I
                  talked about earlier.
                </p>

                <p>
                  Anyway, since the use of another LiveData would solve this, I
                  decided to press on. I wasn’t ready to give up on this sealed
                  classes idea. This time, I rotated the screen. And then this
                  happened:
                </p>

                <p>
                  <img
                    src="assets/images/how-not-to-use-sealed-classes-and-livedata-for-state-management-2.png"
                    alt=""
                  />
                </p>

                <p>Dammit. Why?</p>

                <p>
                  Well, I forgot a very important aspect of LiveData. Each new
                  observer that subscribes to a LiveData receives its
                  <strong>latest</strong> value. Here, the Fragment gets
                  destroyed on rotation, and a new Fragment starts observing the
                  LiveData. The last value emitted by the LiveData was the
                  button label update. That’s why the label is correct, but the
                  list is empty. If I rotate the phone before clicking on any
                  rows, the list will appear since the getUsers API request is
                  async and finishes after the updateButtonLabel call. On the
                  other hand, the button label will show the placeholder text
                  instead of the correct value.
                </p>

                <p>
                  So, ways to solve this. One possibility is, again, different
                  LiveData variables for each sealed class. This is not the most
                  desirable solution though. If we keep adding new LiveData
                  variables, both code maintenance and testing complexity might
                  increase. This was one of the motives between Kaushik’s
                  architecture, if I recall correctly. Another, more sane
                  possibility is to trigger view state updates in the Fragment’s
                  onResume method or similar. Suddenly, events make sense. The
                  third option I can think of breaks my heart: use a class for
                  the whole state, instead of sealed classes (Sorry Kaushik, I
                  will never doubt your work again).
                </p>

                <h3 id="final-thoughts">Final Thoughts</h3>

                <p>
                  I ended up using a single class to the whole state . With the
                  LiveData and sealed classes setup, I got to a point where I
                  had a different LiveData for each sealed class, which defeats
                  the purpose of the whole thing. I even had to stop ignoring
                  the RecyclerView’s internal state, since it gets reset on
                  configuration changes.
                </p>

                <p>
                  I’m also using events, although there was no functional need
                  for them in this case: since LiveData will always emit the
                  latest global state for the view, I don’t need to cause an
                  explicit state update on configuration change. Regardless,
                  they do make the code look more structured to me. I like
                  having all state changing events going through the same
                  method. It feels like this should help in keeping things more
                  or less simple on a more complex UI. In the end, the
                  architecture became a simplified version of the one presented
                  in the Fragmented podcast.
                </p>

                <p>
                  Although redrawing the whole UI seems exaggerated, the process
                  is actually very smooth. While this might not hold for a more
                  complex UI, it should be able to handle most cases.
                </p>

                <p>
                  You can find all the code (in its final state) in my
                  <a
                    href="https://github.com/rcosteira79/AndroidMultiModuleCleanArchTemplate"
                    >multi module clean architecture template</a
                  >, in the <code>RecyclerViewExample</code> module.
                </p>

                <p>
                  As I said before, this is not an architecture recommendation.
                  While this might work for some cases, other alternatives such
                  as databinding or multiple LiveData variables managed by a
                  MediatorLiveData (<a
                    href="https://medium.com/@Zhuinden/if-there-are-many-events-id-just-combine-them-together-with-a-mediatorlivedata-or-with-rx-a0494953a578"
                    >as suggested by Gabor Varadi</a
                  >) might even be a better fit. I’m a fan of this approach, but
                  it’s up to you to figure out what’s best for your specific
                  case.
                </p>

                <hr />

                <p>
                  Thank you very much for reading the article. I really hope it
                  was worth it! Do you have any ideas? Would you do something
                  differently? If so, please leave a comment or reach out on
                  Twitter. See you next time!
                </p>
              </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->

            <footer class="post-full-footer">
              <!-- Everything inside the #author tags pulls data from the author -->
              <!-- #author-->
              <!-- 
                    
                        <section class="author-card">
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/ricardo">Ricardo Costeira</a></h4>
                                
                                    <p>Read <a href="/author/ricardo">more posts</a> by this author.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/ricardo">Read More</a>
                        </div>
                    
                 -->
              <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->

            <section class="post-full-comments">
              <div id="disqus_thread"></div>
              <script>
                var disqus_config = function() {
                  this.page.url =
                    "https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management";
                  this.page.identifier =
                    "/how-not-to-use-sealed-classes-and-livedata-for-state-management";
                };
                (function() {
                  var d = document,
                    s = d.createElement("script");
                  s.src = "https://ricardocosteira-com.disqus.com/embed.js";
                  s.setAttribute("data-timestamp", +new Date());
                  (d.head || d.body).appendChild(s);
                })();
              </script>
            </section>
          </article>
        </div>
      </main>

      <!-- Links to Previous/Next posts -->
      <aside class="read-next outer">
        <div class="inner">
          <div class="read-next-feed">
            <article
              class="read-next-card"
              style="background-image: url(/assets/images/cover.jpeg)"
            >
              <header class="read-next-card-header">
                <small class="read-next-card-header-sitetitle"
                  >&mdash; Ricardo Costeira &mdash;</small
                >

                <h3 class="read-next-card-header-title">
                  <a href="/tag/android/">Android</a>
                </h3>
              </header>
              <div class="read-next-divider">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"
                  />
                </svg>
              </div>
              <div class="read-next-card-content">
                <ul>
                  <li>
                    <a
                      href="/glideing-your-way-into-recyclerview-state-invalidation"
                      >Glide'ing your way into RecyclerView state
                      invalidation</a
                    >
                  </li>

                  <li>
                    <a href="/my-talk-about-kotlin-flow-at-devfest-leiria-2019"
                      >My talk about Kotlin Flow at DevFest Leiria 2019</a
                    >
                  </li>

                  <li>
                    <a href="/going-with-the-flow-rxjava-to-coroutines-part-1"
                      >Going with the Flow: from RxJava to Kotlin coroutines -
                      Part 1</a
                    >
                  </li>
                </ul>
              </div>
              <footer class="read-next-card-footer">
                <a href="/tag/android/">
                  See all 4 posts →
                </a>
              </footer>
            </article>

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->

            <article class="post-card post-template">
              <a
                class="post-card-image-link"
                href="/going-with-the-flow-rxjava-to-coroutines-part-1"
              >
                <div
                  class="post-card-image"
                  style="background-image: url(/assets/images/going-with-the-flow-rxjava-to-coroutines-part-1.jpg)"
                ></div>
              </a>

              <div class="post-card-content">
                <a
                  class="post-card-content-link"
                  href="/going-with-the-flow-rxjava-to-coroutines-part-1"
                >
                  <header class="post-card-header">
                    <span class="post-card-tags">Android</span>

                    <h2 class="post-card-title">
                      Going with the Flow: from RxJava to Kotlin coroutines -
                      Part 1
                    </h2>
                  </header>
                  <section class="post-card-excerpt">
                    <p>
                      I’ve been playing around with Kotlin’s coroutines library.
                      I had some trouble wrapping my head around the whole
                      coroutine concept, mainly because I was consistently
                      looking out for RxJava resemblances. Well, the truth
                    </p>
                  </section>
                </a>
                <footer class="post-card-meta">
                  <!-- 
                    
                        
                        <span class="post-card-author">
                            <a href="/author/ricardo/">Ricardo Costeira</a>
                        </span>
                    
                 -->
                  <span class="reading-time">
                    12 min read
                  </span>
                </footer>
              </div>
            </article>

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->

            <article class="post-card post-template">
              <a
                class="post-card-image-link"
                href="/encapsulate-and-abstract-for-future-proof-software"
              >
                <div
                  class="post-card-image"
                  style="background-image: url(/assets/images/encapsulate-and-abstract-for-future-proof-software.jpg)"
                ></div>
              </a>

              <div class="post-card-content">
                <a
                  class="post-card-content-link"
                  href="/encapsulate-and-abstract-for-future-proof-software"
                >
                  <header class="post-card-header">
                    <span class="post-card-tags">Android</span>

                    <h2 class="post-card-title">
                      Encapsulate and abstract for future proof software
                    </h2>
                  </header>
                  <section class="post-card-excerpt">
                    <p>
                      Change will always affect your software. No matter the
                      domain, the uses cases, the developers, or even the users.
                      Change is the one constant in software development.
                    </p>
                  </section>
                </a>
                <footer class="post-card-meta">
                  <!-- 
                    
                        
                        <span class="post-card-author">
                            <a href="/author/ricardo/">Ricardo Costeira</a>
                        </span>
                    
                 -->
                  <span class="reading-time">
                    3 min read
                  </span>
                </footer>
              </div>
            </article>
          </div>
        </div>
      </aside>

      <!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
      <div class="floating-header">
        <div class="floating-header-logo">
          <a href="https://ricardocosteira.com/">
            <img src="/assets/images/favicon.png" alt="Ricardo Costeira icon" />

            <span style="letter-spacing: 0.05em;">Ricardo Costeira</span>
          </a>
        </div>
        <span class="floating-header-divider">&mdash;</span>
        <div class="floating-header-title">
          How not to use sealed classes and LiveData for state management
        </div>
        <div class="floating-header-share">
          <div class="floating-header-share-label">Share</div>
          <a
            class="floating-header-share-tw"
            href="https://twitter.com/share?text=How+not+to+use+sealed+classes+and+LiveData+for+state+management&amp;url=https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
              <path
                d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"
              />
            </svg>
          </a>
          <a
            class="floating-header-share-fb"
            href="https://www.facebook.com/sharer/sharer.php?u=https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
              <path
                d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"
              />
            </svg>
          </a>
          <a
            class="floating-header-share-lkd"
            href="https://www.linkedin.com/shareArticle/?mini=true&url=https://ricardocosteira.com/how-not-to-use-sealed-classes-and-livedata-for-state-management
        &title=How not to use sealed classes and LiveData for state management
        &source=https://ricardocosteira.com"
            onclick="window.open(this.href, 'share-linkedin','width=500,height=500');return false;"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
              <path
                d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"
              />
            </svg>
          </a>
        </div>
        <progress class="progress" value="0">
          <div class="progress-container">
            <span class="progress-bar"></span>
          </div>
        </progress>
      </div>

      <!-- /post -->

      <!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->

      <!-- Previous/next page links - displayed on every page -->

      <!-- The footer at the very bottom of the screen -->
      <footer class="site-footer outer">
        <div class="site-footer-content inner">
          <section class="copyright">
            <a href="https://ricardocosteira.com/">Ricardo Costeira</a>
            &copy; 2020
          </section>
          <section class="poweredby">
            Published with <a href="https://jekyllrb.com/">Jekyll</a> &
            <a href="https://pages.github.com/" target="_blank" rel="noopener"
              >GitHub Pages</a
            >. Based on
            <a
              href="https://github.com/jekyller/jasper2"
              target="_blank"
              rel="noopener"
              >Jasper2</a
            >
          </section>
          <nav class="site-footer-nav">
            <a
              class="social-link social-link-gh"
              href="https://github.com/rcosteira79"
              target="_blank"
              rel="noopener"
              ><svg
                role="img"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
                /></svg
            ></a>

            <a
              class="social-link social-link-tw"
              href="https://twitter.com/rcosteira79"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                <path
                  d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"
                />
              </svg>
            </a>

            <a
              class="social-link social-link-lkd"
              href="https://linkedin.com/in/rcosteira"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                <path
                  d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"
                /></svg
            ></a>

            <a
              class="social-link social-link-stackoverflow"
              href="https://stackoverflow.com/users/2333010/ricardo-costeira"
              target="_blank"
              rel="noopener"
              ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                <path
                  d="M15 21h-10v-2h10v2zm6-11.665l-1.621-9.335-1.993.346 1.62 9.335 1.994-.346zm-5.964 6.937l-9.746-.975-.186 2.016 9.755.879.177-1.92zm.538-2.587l-9.276-2.608-.526 1.954 9.306 2.5.496-1.846zm1.204-2.413l-8.297-4.864-1.029 1.743 8.298 4.865 1.028-1.744zm1.866-1.467l-5.339-7.829-1.672 1.14 5.339 7.829 1.672-1.14zm-2.644 4.195v8h-12v-8h-2v10h16v-10h-2z"
                /></svg
            ></a>

            <a
              class="social-link social-link-medium"
              href="https://medium.com/@rcosteira79"
              target="_blank"
              rel="noopener"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                fill-rule="evenodd"
                clip-rule="evenodd"
                viewBox="0 0 32 32"
              >
                <path
                  d="M2.846 6.887c.03-.295-.083-.586-.303-.784l-2.24-2.7v-.403h6.958l5.378 11.795 4.728-11.795h6.633v.403l-1.916 1.837c-.165.126-.247.333-.213.538v13.498c-.034.204.048.411.213.537l1.871 1.837v.403h-9.412v-.403l1.939-1.882c.19-.19.19-.246.19-.537v-10.91l-5.389 13.688h-.728l-6.275-13.688v9.174c-.052.385.076.774.347 1.052l2.521 3.058v.404h-7.148v-.404l2.521-3.058c.27-.279.39-.67.325-1.052v-10.608z"
                /></svg
            ></a>

            <a
              class="social-link social-link-devto"
              href="https://dev.to/rcosteira79"
              target="_blank"
              rel="noopener"
              ><svg
                role="img"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"
              >
                <path
                  fill="#ffffff"
                  d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"
                ></path></svg
            ></a>
          </nav>
        </div>
        <script src="/assets/js/prism.js"></script>
        <script src="/assets/js/prism-line-numbers.js"></script>
      </footer>
    </div>

    <!-- The big email subscribe modal content -->

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>
      $(document).ready(function() {
        $("pre code").each(function(i, block) {
          hljs.highlightBlock(block);
        });
      });
    </script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script
      type="text/javascript"
      src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"
    ></script>

    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
    <script>
      (function(i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function() {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-142536212-1", "auto");
      ga("send", "pageview");
    </script>

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    <script>
      // NOTE: Scroll performance is poor in Safari
      // - this appears to be due to the events firing much more slowly in Safari.
      //   Dropping the scroll event and using only a raf loop results in smoother
      //   scrolling but continuous processing even when not scrolling
      $(document).ready(function() {
        // Start fitVids
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // End fitVids

        var progressBar = document.querySelector("progress");
        var header = document.querySelector(".floating-header");
        var title = document.querySelector(".post-full-title");

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
          lastScrollY = window.scrollY;
          requestTick();
        }

        function onResize() {
          lastWindowHeight = window.innerHeight;
          lastDocumentHeight = $(document).height();
          requestTick();
        }

        function requestTick() {
          if (!ticking) {
            requestAnimationFrame(update);
          }
          ticking = true;
        }

        function update() {
          var trigger = title.getBoundingClientRect().top + window.scrollY;
          var triggerOffset = title.offsetHeight + 35;
          var progressMax = lastDocumentHeight - lastWindowHeight;

          // show/hide floating header
          if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add("floating-active");
          } else {
            header.classList.remove("floating-active");
          }

          progressBar.setAttribute("max", progressMax);
          progressBar.setAttribute("value", lastScrollY);

          ticking = false;
        }

        window.addEventListener("scroll", onScroll, { passive: true });
        window.addEventListener("resize", onResize, false);

        update();
      });
    </script>

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->
  </body>
</html>
